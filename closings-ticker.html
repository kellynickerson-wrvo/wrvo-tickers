<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap');

  #wrvo-ticker-container {
    display: none; 
    width: 100%;
    margin: 0;
    font-family: 'Roboto', sans-serif;
    position: -webkit-sticky; 
    position: sticky;
    
    /* THE MATH: Header (~40-50px) + Player (50px) */
    top: 95px; 
    
    z-index: 999; 
    background-color: #ffffff;
    padding-bottom: 5px;
  }

  #ticker-link-wrap {
    text-decoration: none;
    display: block;
    width: 100%;
  }

  #ticker-bar {
    display: flex;
    width: 100%;
    height: 50px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0,0,0,0.15);
    position: relative;
  }

  #ticker-label {
    background-color: #bd2100;
    color: #ffffff;
    font-weight: 900;
    text-transform: uppercase;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    z-index: 10;
    font-size: 14px;
    letter-spacing: 1px;
    border-right: 2px solid #ffffff;
  }

  #ticker-main {
    background-color: #204180;
    flex-grow: 1;
    position: relative;
    display: flex;
    align-items: center;
    overflow: hidden;
  }

  #ticker-track {
    display: flex;
    white-space: nowrap;
    position: absolute;
    will-change: transform;
  }

  .ticker-item {
    color: #ffffff;
    font-size: 17px;
    margin-right: 100px;
    display: flex;
    align-items: center;
  }

  .ticker-school { font-weight: 700; margin-right: 8px; text-transform: uppercase; }

  /* Close Button Customization */
  #ticker-close {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    background: rgba(0,0,0,0.3);
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    cursor: pointer;
    z-index: 20;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  }
  #ticker-close:hover { background: rgba(0,0,0,0.6); }

  #ticker-timestamp {
    display: block;
    width: 100%;
    text-align: right;
    font-size: 10px;
    color: #000000;
    margin-top: 3px;
    padding-right: 10px;
  }

  @keyframes marquee {
    from { transform: translateX(100vw); }
    to { transform: translateX(-100%); }
  }

  #ticker-link-wrap:hover #ticker-track { animation-play-state: paused; }
</style>

<div id="wrvo-ticker-container">
  <button id="ticker-close" onclick="document.getElementById('wrvo-ticker-container').style.display='none'">Ã—</button>
  <a href="https://www.wrvo.org/closings-delays" id="ticker-link-wrap" target="_blank">
    <div id="ticker-bar">
      <div id="ticker-label">Closings & Delays</div>
      <div id="ticker-main"><div id="ticker-track"></div></div>
    </div>
    <div id="ticker-timestamp">Checking for updates...</div>
  </a>
</div>

<script>
async function startTicker() {
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRijmTFMmlSUW6T-q2Yt_0QW0Y_2BLXVyxmX49Grb8gZFfJ0oh7lzdSPON1F0QRHum75rkoEJrLdb-b/pub?output=csv";
  const container = document.getElementById('wrvo-ticker-container');
  const track = document.getElementById('ticker-track');
  const main = document.getElementById('ticker-main');
  
  try {
    const response = await fetch(`${csvUrl}&t=${new Date().getTime()}`);
    const text = await response.text();
    const rows = text.split(/\r?\n/).filter(row => row.trim() !== "");
    let tickerHtml = "";
    let entriesFound = 0;

    for (let i = 0; i < rows.length; i++) {
      const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      if (cols.length >= 2) {
        const school = cols[0].replace(/"/g, "").trim();
        if (school.toLowerCase() === "school" || school.toLowerCase() === "school name") continue;

        let statusParts = [];
        for (let j = 1; j <= 3; j++) {
            if (cols[j]) {
                const clean = cols[j].replace(/"/g, "").trim();
                if (clean) statusParts.push(clean);
            }
        }
        if (school && statusParts.length > 0) {
          tickerHtml += `<span class="ticker-item"><span class="ticker-school">${school}:</span> ${statusParts.join(" | ")}</span>`;
          entriesFound++;
        }
      }
    }

    if (entriesFound > 0) {
      track.innerHTML = tickerHtml;
      container.style.display = 'block';
      const now = new Date();
      document.getElementById('ticker-timestamp').innerText = "Last Updated: " + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      const duration = (main.offsetWidth + track.offsetWidth) / 70;
      track.style.animation = `marquee ${duration}s linear infinite`;
    } else {
      container.style.display = 'none';
    }
  } catch (err) { container.style.display = 'none'; }
}
startTicker();
setInterval(startTicker, 300000);
</script>
